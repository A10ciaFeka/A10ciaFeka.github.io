<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        @font-face {
            font-family: dsFontBold;
            src: url('assets/fonts/OptimusPrincepsSemiBold.ttf');
        }

        @font-face {
            font-family: dsFont;
            src: url('assets/fonts/OptimusPrinceps.ttf');
        }

        h1{
            font-size: 50px;
        }

        body{
            margin: 0;
            padding: 0;
            
            font-family: dsFontBold;
            background-color: gray;
        }

        .container{
            margin: 5em auto;
            padding: 2em;
            background-color: black;
            color: whitesmoke;
            width: fit-content;
            border: 2px solid black;
            border-radius: 10px;
            text-align: center;
        }

        .button-6 {
            font-family: dsFont;
            align-items: center;
            background-color: #FFFFFF;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: .25rem;
            box-shadow: rgba(0, 0, 0, 0.02) 0 1px 3px 0;
            box-sizing: border-box;
            color: rgba(0, 0, 0, 0.85);
            cursor: pointer;
            display: inline-flex;
            font-size: 25px;
            justify-content: center;
            line-height: 1;
            margin-top: 1em;
            min-height: 3rem;
            padding: calc(.875rem - 1px) calc(1.5rem - 1px);
            position: relative;
            text-decoration: none;
            transition: all 250ms;
            user-select: none;
            -webkit-user-select: none;
            touch-action: manipulation;
            vertical-align: baseline;
            width: auto;
        }

        .button-6:hover,
        .button-6:focus {
            border-color: rgba(0, 0, 0, 0.15);
            box-shadow: rgba(0, 0, 0, 0.1) 0 4px 12px;
        }

        .button-6:hover {
            transform: translateY(-1px);
        }

        .button-6:active {
            background-color: #F0F0F1;
            border-color: rgba(0, 0, 0, 0.15);
            box-shadow: rgba(0, 0, 0, 0.06) 0 2px 4px;
            color: rgba(0, 0, 0, 0.65);
            transform: translateY(0);
        }

        a{
            text-decoration: none;
            color: black;
        }

        .botones{
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #btSubmit{
            font-size: 20px;
            padding: 5px;
            background-color: gray;
            color: white;
        }

        .reglas h2{
            border-bottom: 2px solid white;
        }

        .regla{
            margin: 1em;
            border-bottom: 2px solid white;
        }

        .regla img{
            margin-bottom: 1em;
        }
    </style>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet">
    <script>

        async function comprobarNombre(nombre){
            const url = "https://darktestapi.herokuapp.com/user/'"+nombre+"'";
            let resultado = await fetch(url);
            resultado = await resultado.json();
            
            return resultado.length==0;
        }

        const insertarUsuario = (objUsuario)=>{
            const url = "https://darktestapi.herokuapp.com/user";
            fetch(url, {
                method: 'POST',
                mode: 'cors',
                headers: {
                    'Accept': 'application/json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(objUsuario)
            })
        }

        const validarFormulario = ()=>{
            document.querySelector('#btSubmit').addEventListener('click',async(e)=>{
                e.preventDefault();
                let nombre = document.querySelector('input').value;
                
                if(await comprobarNombre(nombre)){
                    objUsuario = {
                        "user_name": nombre,
                        "user_points": '0'
                    }

                    insertarUsuario(objUsuario);
                    localStorage.setItem('usuario',JSON.stringify(objUsuario));
                    window.setTimeout(function(){
                        document.querySelector('form').submit();
                    },3000);

                }else{
                    alert('Nombre no disponible');
                }

            });
        }

        window.onload = ()=>{
            document.querySelectorAll('button').forEach(item =>{
                item.addEventListener('click',(e)=>{
        
                    if(item.id!='mute' && item.id!='sound'){
                        let sonido = document.createElement('audio');
                        sonido.src = 'assets/btpress.mp3';
                        sonido.autoplay = true;
                        sonido.hidden = true;
        
                        document.body.appendChild(sonido);
        
                        window.setTimeout(function(){
                            document.body.removeChild(sonido);
                        },3000);
                        
                        if(item.id=='historia'){
                            window.setTimeout(function(){
                                window.location.href = 'historia.html';
                            },1800);
                        }

                        if(item.id=='btRegla'){
                            let reglas = document.querySelector('.reglas');
                            console.log(reglas.style.display)
                            if(reglas.style.display=='none'){
                                reglas.style.display = 'block';
                            }else{
                                reglas.style.display = 'none';
                            }
                        }

                        if(item.id=='jugar'){
                            // if(localStorage.getItem('usuario')){
                        
                                window.setTimeout(function(){
                                    window.location.href = 'juego.html';
                                },1800);
                            // }else{
                            //     document.querySelector('.form').style.display = 'flex';
                            //     validarFormulario();
                            // }
                        }
        
                    }else if(item.id!='sound'){
                        item.id = 'sound';
                        document.querySelector('i').textContent = 'volume_off';
                        document.getElementById('introAudio').muted = true;
                    }else{
                        item.id = 'mute';
                        document.querySelector('i').textContent = 'volume_up';
                        document.getElementById('introAudio').muted = false;
                    }
                })
            });
        }
    </script>
    <title>Dark Tests</title>
</head>
<body>
    <audio src="assets/intro.mp3" autoplay preload="auto" hidden loop id="introAudio"></audio>
    <div class="container">
        <h1>Dark Tests</h1>
        <div class="botones">
            <div>
                <button class="button-6" id="jugar">Jugar</button>
            </div>
            <div style="display: none;" class="form">
                <form action="juego.html">
                    <label>Nombre:<input type="text"></label>
                    <button class="button-6" id="btSubmit">Enviar</button>
                </form>
            </div>
            <div>
                <button class="button-6" id="btRegla">Reglas</button>
            </div>
            <div class="reglas" style="display: none;">
                <h2>Reglas</h2>
                <div class="regla">
                    <p>Solamente puedes hacer movimientos verticales y horizontales</p>
                    <img src="assets/img/regla1.PNG" width="200">
                </div>
                <div class="regla">
                    <p>Debes agarrar las ascuas para poder escapar</p>
                    <img src="assets/img/regla2.PNG" width="150">
                </div>
                <div class="regla">
                    <p>Escapa por la salida con las ascuas sin que te pille Lacobus</p>
                    <img src="assets/img/regla3.PNG" width="200">
                </div>
            </div>
            <div>
                <button class="button-6" id="historia">Historia</button>
            </div>
            <div>
                <button class="button-6" id="mute"><i class="material-icons">volume_up</i></button>
            </div>
        </div>
    </div>

</body>
</html>